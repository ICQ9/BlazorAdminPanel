@page "/dashboard"
@using System.Globalization
@using AdminPanel.Services
@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager NavigationManager
@inject ApiAuthenticationStateProvider AuthStateProvider

<AuthorizeView>
    <Authorized>
        <PageTitle>Dashboard</PageTitle>

        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
            <MudGrid>
                <MudItem xs="12">
                    <MudPaper Class="pa-4">
                        <MudGrid>
                            <MudItem xs="12" md="6">
                                <MudText Typo="Typo.h6">Advertiser ID: @AdvertiserId</MudText>
                                <MudText Typo="Typo.body1">Balance: @Balance.ToString("C2", new CultureInfo("en-US"))</MudText>
                            </MudItem>
                            <MudItem xs="12" md="6" Class="d-flex justify-end">
                                <MudSelect T="string" Label="Period" @bind-Value="SelectedPeriod" Class="mt-0" Style="width: 200px;">
                                    <MudSelectItem Value="@("today")">Today</MudSelectItem>
                                    <MudSelectItem Value="@("yesterday")">Yesterday</MudSelectItem>
                                    <MudSelectItem Value="@("last7days")">Last 7 Days</MudSelectItem>
                                    <MudSelectItem Value="@("last30days")">Last 30 Days</MudSelectItem>
                                    <MudSelectItem Value="@("thismonth")">This Month</MudSelectItem>
                                    <MudSelectItem Value="@("lastmonth")">Last Month</MudSelectItem>
                                    <MudSelectItem Value="@("custom")">Custom Period</MudSelectItem>
                                </MudSelect>
                            </MudItem>
                        </MudGrid>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12">
                    <MudText Typo="Typo.h5" Class="mb-4">Metrics Overview</MudText>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">Ad Spend</MudText>
                        <MudText Typo="Typo.h4">@AdSpend.ToString("N2")</MudText>
                        <MudText Color="@(AdSpendChange > 0 ? Color.Success : Color.Error)">
                            @(AdSpendChange > 0 ? "▲" : "▼") @Math.Abs(AdSpendChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">Clicks</MudText>
                        <MudText Typo="Typo.h4">@Clicks.ToString("N0")</MudText>
                        <MudText Color="@(ClicksChange > 0 ? Color.Success : Color.Error)">
                            @(ClicksChange > 0 ? "▲" : "▼") @Math.Abs(ClicksChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">CTR %</MudText>
                        <MudText Typo="Typo.h4">@Ctr.ToString("0.00")</MudText>
                        <MudText Color="@(CtrChange > 0 ? Color.Success : Color.Error)">
                            @(CtrChange > 0 ? "▲" : "▼") @Math.Abs(CtrChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">Sales</MudText>
                        <MudText Typo="Typo.h4">@Sales.ToString("N0")</MudText>
                        <MudText Color="@(SalesChange > 0 ? Color.Success : Color.Error)">
                            @(SalesChange > 0 ? "▲" : "▼") @Math.Abs(SalesChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">Revenue</MudText>
                        <MudText Typo="Typo.h4">@Revenue.ToString("N2")</MudText>
                        <MudText Color="@(RevenueChange > 0 ? Color.Success : Color.Error)">
                            @(RevenueChange > 0 ? "▲" : "▼") @Math.Abs(RevenueChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12" sm="6" md="4">
                    <MudPaper Class="pa-4" Elevation="2">
                        <MudText Typo="Typo.subtitle1">ROAS %</MudText>
                        <MudText Typo="Typo.h4">@Roas.ToString("0.00")</MudText>
                        <MudText Color="@(RoasChange > 0 ? Color.Success : Color.Error)">
                            @(RoasChange > 0 ? "▲" : "▼") @Math.Abs(RoasChange).ToString("0.00")%
                        </MudText>
                    </MudPaper>
                </MudItem>

                <MudItem xs="12">
                    <MudText Typo="Typo.h5" Class="my-4">Active Campaigns</MudText>
                    <MudTable Items="@Campaigns" Dense="true" Hover="true" Bordered="true" Striped="true">
                        <HeaderContent>
                            <MudTh>Campaign</MudTh>
                            <MudTh>Views</MudTh>
                            <MudTh>Clicks</MudTh>
                            <MudTh>CTR %</MudTh>
                            <MudTh>Sales</MudTh>
                            <MudTh>CR %</MudTh>
                            <MudTh>Revenue</MudTh>
                            <MudTh>ROAS %</MudTh>
                        </HeaderContent>
                        <RowTemplate Context="campaign">
                            <MudTd DataLabel="Campaign">@campaign.Name</MudTd>
                            <MudTd DataLabel="Views">@campaign.Views.ToString("N0")</MudTd>
                            <MudTd DataLabel="Clicks">@campaign.Clicks.ToString("N0")</MudTd>
                            <MudTd DataLabel="CTR %">@campaign.Ctr.ToString("0.0")</MudTd>
                            <MudTd DataLabel="Sales">@campaign.Sales.ToString("N0")</MudTd>
                            <MudTd DataLabel="CR %">@campaign.ConversionRate.ToString("0.0")</MudTd>
                            <MudTd DataLabel="Revenue">@campaign.Revenue.ToString("N2")</MudTd>
                            <MudTd DataLabel="ROAS %">@campaign.Roas.ToString("0.0")</MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </Authorized>
    <NotAuthorized>
        @{
            NavigationManager.NavigateTo("/login");
        }
    </NotAuthorized>
</AuthorizeView>

@code {
    private string AdvertiserId { get; set; } = "ID43456";
    private decimal Balance { get; set; } = 123.45m;
    private string SelectedPeriod { get; set; } = "today";

    // Metrics data
    private decimal AdSpend { get; set; } = 1200.01m;
    private decimal AdSpendChange { get; set; } = 22.50m;

    private int Clicks { get; set; } = 4321;
    private decimal ClicksChange { get; set; } = -10.50m;

    private decimal Ctr { get; set; } = 2.25m;
    private decimal CtrChange { get; set; } = -0.10m;

    private int Sales { get; set; } = 456;
    private decimal SalesChange { get; set; } = 18.80m;

    private decimal Revenue { get; set; } = 16234.78m;
    private decimal RevenueChange { get; set; } = 3.60m;

    private decimal Roas { get; set; } = 125.01m;
    private decimal RoasChange { get; set; } = -4.30m;

    // Campaign data
    private List<Campaign> Campaigns { get; set; } = new List<Campaign>
    {
        new Campaign
        {
            Name = "Brand promo",
            Views = 3000,
            Clicks = 45,
            Ctr = 1.5m,
            Sales = 4,
            ConversionRate = 8.9m,
            Revenue = 1234.50m,
            Roas = 425.70m
        },
        new Campaign
        {
            Name = "Brand promo 1",
            Views = 3000,
            Clicks = 45,
            Ctr = 1.5m,
            Sales = 4,
            ConversionRate = 8.9m,
            Revenue = 1234.50m,
            Roas = 425.70m
        },
        new Campaign
        {
            Name = "Brand promo 2",
            Views = 3000,
            Clicks = 45,
            Ctr = 1.5m,
            Sales = 4,
            ConversionRate = 8.9m,
            Revenue = 1234.50m,
            Roas = 425.70m
        },
        new Campaign
        {
            Name = "Brand promo 3",
            Views = 3000,
            Clicks = 45,
            Ctr = 1.5m,
            Sales = 4,
            ConversionRate = 8.9m,
            Revenue = 1234.50m,
            Roas = 425.70m
        },
        new Campaign
        {
            Name = "Brand promo 4",
            Views = 3000,
            Clicks = 45,
            Ctr = 1.5m,
            Sales = 4,
            ConversionRate = 8.9m,
            Revenue = 1234.50m,
            Roas = 425.70m
        }
    };

    public class Campaign
    {
        public string Name { get; set; }
        public int Views { get; set; }
        public int Clicks { get; set; }
        public decimal Ctr { get; set; }
        public int Sales { get; set; }
        public decimal ConversionRate { get; set; }
        public decimal Revenue { get; set; }
        public decimal Roas { get; set; }
    }
}